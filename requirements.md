# ComfyUI插件开发环境需求规格说明书

## 1. 简介

### 1.1 目的
本文档详细说明开发ComfyUI插件所需的环境配置、技术要求和基础设施，为开发者提供完整的环境搭建指南。

### 1.2 适用范围
适用于希望开发ComfyUI自定义节点和插件的AI开发者、图像处理工程师及相关技术人员。

### 1.3 术语定义
- **ComfyUI**: 一种基于节点流程的Stable Diffusion操作界面
- **节点(Node)**: ComfyUI中的功能模块单元
- **工作流(Workflow)**: 由多个节点连接组成的处理流程
- **自定义节点(Custom Node)**: 用户自定义的功能节点

## 2. 系统环境要求

### 2.1 硬件要求

| 组件 | 最低要求 | 推荐配置 |
|-----|---------|---------|
| CPU | Intel i5/AMD Ryzen 5 | Intel i7/AMD Ryzen 7或更高 |
| GPU | NVIDIA GPU，4GB显存 | NVIDIA RTX系列，8GB+显存 |
| 内存 | 16GB RAM | 32GB RAM |
| 存储 | 50GB可用空间 | 100GB+SSD |
| 网络 | 宽带互联网连接 | 高速互联网连接 |

### 2.2 软件环境

| 软件 | 版本要求 | 说明 |
|-----|---------|-----|
| 操作系统 | Windows 10/11, Ubuntu 20.04+, macOS 12+ | Windows系统为主要开发环境 |
| Python | 3.10.6 (推荐) | 不建议使用3.11+，可能存在兼容性问题 |
| CUDA | 11.7+或12.1 | 用于NVIDIA GPU加速 |
| Git | 最新版 | 用于版本控制 |
| VS Code/PyCharm | 最新版 | 推荐的IDE工具 |

### 2.3 依赖库要求

| 库名 | 版本要求 | 用途 |
|-----|---------|-----|
| PyTorch | >=2.0.0 | 深度学习框架 |
| torchvision | 兼容PyTorch版本 | 图像处理工具 |
| numpy | >=1.22.0 | 数学计算 |
| pillow | >=9.0.0 | 图像处理 |
| transformers | 可选 | NLP模型支持 |
| diffusers | 可选 | 扩散模型支持 |
| opencv-python | 可选 | 计算机视觉处理 |

## 3. 安装和配置流程

### 3.1 基础环境配置
1. 安装Python环境管理工具(Miniconda)
2. 创建专用虚拟环境
3. 安装PyTorch和CUDA支持
4. 验证GPU支持

### 3.2 ComfyUI安装
1. 选择安装方式(便携版/源码)
2. 下载并配置ComfyUI
3. 验证基本功能

### 3.3 插件开发环境设置
1. 创建插件目录结构
2. 初始化基本文件
3. 安装开发工具(VS Code/PyCharm)
4. 配置调试环境

## 4. 目录结构规范

### 4.1 插件标准目录
```
ComfyUI_自定义插件名称/
├── __init__.py          # 插件入口点
├── nodes.py             # 节点实现
├── requirements.txt     # 依赖列表
├── README.md            # 文档说明
├── setup.py             # 安装脚本
├── js/                  # 前端脚本(可选)
├── models/              # 模型文件(可选)
├── examples/            # 示例工作流
└── tests/               # 测试目录
```

### 4.2 文件命名规范
- 使用小写字母和下划线
- Python模块使用snake_case
- 类名使用CamelCase
- 常量使用大写字母和下划线

## 5. 开发环境验证

### 5.1 环境验证检查清单
- [ ] Python环境正确配置
- [ ] PyTorch能够识别GPU
- [ ] ComfyUI能够正常启动
- [ ] 能够加载自定义节点
- [ ] 能够成功执行简单工作流

### 5.2 验证脚本
提供环境验证脚本，用于检查所有组件是否正确安装和配置。

## 6. 依赖管理

### 6.1 依赖安装机制
```bash
pip install -r requirements.txt
```

### 6.2 版本控制策略
- 明确指定主要依赖的版本号
- 定期更新依赖版本
- 使用虚拟环境隔离不同项目

### 6.3 依赖冲突解决
提供识别和解决依赖冲突的步骤

## 7. 调试与测试环境

### 7.1 调试配置
- VS Code/PyCharm调试配置
- 日志记录设置
- 断点和变量监视

### 7.2 测试框架
- 单元测试设置
- 集成测试工作流
- 性能测试方法

## 8. 模型和资源管理

### 8.1 模型存储结构
```
ComfyUI/
└── models/
    ├── checkpoints/      # SD模型
    ├── custom/           # 自定义模型
        └── my_plugin_models/  # 插件专用模型
```

### 8.2 资源文件管理策略
- 大型文件使用Git LFS管理
- 使用自动下载脚本获取模型
- 提供校验机制确保完整性

## 9. 部署与发布

### 9.1 部署方式
- 直接复制到custom_nodes目录
- 通过ComfyUI Manager安装
- 通过pip安装(高级)

### 9.2 版本管理要求
- 遵循语义化版本(Semantic Versioning)
- 维护更新日志(CHANGELOG)
- 提供向后兼容性声明

## 10. 持续集成与维护

### 10.1 CI/CD环境
- GitHub Actions配置
- 自动化测试流程
- 打包和发布自动化

### 10.2 更新与维护流程
- 定期检查ComfyUI兼容性
- 版本升级策略
- 废弃功能处理方法

## 11. 开发工具与资源

### 11.1 推荐开发工具
- VS Code或PyCharm: 主要IDE
- Git: 版本控制
- Conda/venv: 环境管理

### 11.2 参考资源
- ComfyUI官方文档
- PyTorch文档
- 示例插件代码库

## 12. 故障排除指南

### 12.1 常见问题与解决方案
- CUDA相关问题
- 依赖冲突问题
- 路径与加载问题

### 12.2 诊断工具
- 日志分析方法
- 性能监控工具
- 内存使用分析

## 13. 安全与合规

### 13.1 代码安全要求
- 避免硬编码敏感信息
- 使用安全的依赖版本
- 输入验证与数据处理安全性

### 13.2 许可证合规
- 选择合适的开源许可证
- 第三方库许可证兼容性审查
- 版权声明要求

## 附录A: 环境设置脚本

### A.1 Windows环境设置脚本(setup_env.bat)
```batch
@echo off
:: 安装Miniconda
:: 创建Python环境
:: 安装依赖
:: 验证环境
```

### A.2 Linux环境设置脚本(setup_env.sh)
```bash
#!/bin/bash
# 安装Miniconda
# 创建Python环境
# 安装依赖
# 验证环境
```

## 附录B: 验证检查列表

详细的环境验证检查清单，确保开发环境满足所有要求。

## 附录C: 故障排除参考表

常见问题的详细排查步骤和解决方案。

---

文档版本: 1.0
最后更新: 2025年3月26日 